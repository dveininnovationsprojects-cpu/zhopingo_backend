const express = require('express');
const router = express.Router();
const paymentCtrl = require('../controllers/paymentController');
const { protect } = require('../middleware/authMiddleware');

/**
 * BASE URL: /api/v1/payments
 */

// ЁЯТ│ 1. Create Payment Session
// роорпКрокрпИро▓рпН роЖрокрпН-ро▓ роЗро░рпБроирпНродрпБ "Pay Now" роХро┐ро│ро┐роХрпН рокрогрпНрогро╛, роЗродрпБ PhonePe Payment URL-роРродрпН родро░рпБроорпН.
// роЗродрпБ 'protect' рооро┐роЯро┐ро▓рпНро╡рпЗро░рпН роХрпКрогрпНроЯрпБ рокро╛родрпБроХро╛роХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ.
router.post('/create-session', protect, paymentCtrl.createSession);

// тЬЕ 2. Verify Payment
// рокрпЗроорпЖрогрпНроЯрпН роорпБроЯро┐роирпНродродрпБроорпН роЖрокрпНрокро┐ро▓рпН роЗро░рпБроирпНродрпБ роЗродрпИ роЕро┤рпИродрпНродро╛ро▓рпН, PhonePe-ро╡ро┐ро▓рпН роЪрпЖроХрпН рокрогрпНрогро┐ 
// роЖро░рпНроЯро░рпИ "Paid" роОрой рооро╛ро▒рпНро▒ро┐ роЯрпЖро▓рпНро▓ро┐ро╡ро░ро┐ AWB роЬрпЖройро░рпЗроЯрпН роЪрпЖропрпНропрпБроорпН.
router.get('/verify/:orderId', protect, paymentCtrl.verifyPayment);

// ЁЯЫ░я╕П 3. Track Order
// роЯрпЖро▓рпНро▓ро┐ро╡ро░ро┐ (Delhivery) ро▓рпИро╡рпН ро╕рпНроЯрпЗроЯрпНроЯро╕рпИ AWB роироорпНрокро░рпН ро╡рпИродрпНродрпБрокрпН рокро╛ро░рпНроХрпНроХ.
router.get('/track/:awb', protect, paymentCtrl.trackOrder);

// ЁЯФД 4. PhonePe Return URL
// рокрпЗроорпЖрогрпНроЯрпН роХрпЗроЯрпНро╡рпЗропро┐ро▓рпН роЗро░рпБроирпНродрпБ рокропройро░рпН родро┐ро░рпБроорпНрокро┐ ро╡ро░рпБроорпНрокрпЛродрпБ (Redirect), 
// роЕро╡ро░рпНроХро│рпИ роорпАрогрпНроЯрпБроорпН роЖрокрпНрокро┐ро▒рпНроХрпБро│рпН (Deep Linking) роХрпКрогрпНроЯрпБ роЪрпЖро▓рпНро▓ роЗродрпБ роЙродро╡рпБроорпН.
// роХрпБро▒ро┐рокрпНрокрпБ: PhonePe роЗродрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроорпН роОройрпНрокродро╛ро▓рпН роЗродро▒рпНроХрпБ 'protect' родрпЗро╡рпИропро┐ро▓рпНро▓рпИ.
router.post('/phonepe-return/:orderId', paymentCtrl.phonepeReturn);

// тЪУ 5. Webhook
// PhonePe роЪро░рпНро╡ро░рпН роирпЗро░роЯро┐ропро╛роХ роироорпН роЪро░рпНро╡ро░рпЛроЯрпБ родрпКроЯро░рпНрокрпБ роХрпКрогрпНроЯрпБ рокрпЗроорпЖрогрпНроЯрпН ро╕рпНроЯрпЗроЯрпНроЯро╕рпИроЪрпН роЪрпКро▓рпНро▓.
// роЗродро▒рпНроХрпБ 'protect' рокрпЛроЯроХрпНроХрпВроЯро╛родрпБ, роПройрпНройрпЖройрпНро▒ро╛ро▓рпН роЗродрпБ роЪро░рпНро╡ро░рпН-роЯрпБ-роЪро░рпНро╡ро░рпН роХро╛ро▓рпН.
router.post('/webhook', paymentCtrl.webhook);

module.exports = router;